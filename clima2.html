<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nexus Weather - Clima Gamer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --secondary: #8b5cf6;
      --accent: #ec4899;
      --dark: #0f172a;
      --darker: #020617;
      --light: #e2e8f0;
      --gray: #64748b;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --rgb-red: #ff006e;
      --rgb-green: #00ff88;
      --rgb-blue: #00d9ff;
      --neon-purple: #bf00ff;
      --neon-blue: #00d4ff;
      --neon-pink: #ff0080;
      
      /* Weather specific colors */
      --weather-card: rgba(15, 23, 42, 0.7);
      --weather-border: rgba(99, 102, 241, 0.3);
      --weather-gradient: linear-gradient(135deg, var(--primary), var(--secondary));
      --chart-line: var(--neon-blue);
      --chart-fill: rgba(0, 217, 255, 0.2);
      --map-bg: rgba(15, 23, 42, 0.5);
      --map-border: rgba(99, 102, 241, 0.3);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      color: var(--light);
      overflow: hidden;
      height: 100vh;
      width: 100vw;
      position: fixed;
      top: 0;
      left: 0;
    }
    
    /* Animated background */
    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(236, 72, 153, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 80%, rgba(16, 185, 129, 0.1) 0%, transparent 50%);
      animation: bgPulse 20s ease-in-out infinite;
      z-index: -1;
    }
    
    @keyframes bgPulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }
    
    .font-orbitron {
      font-family: 'Orbitron', monospace;
    }
    
    /* Glass morphism effect */
    .glass {
      background: rgba(15, 23, 42, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(99, 102, 241, 0.3);
    }
    
    .glass-light {
      background: rgba(30, 41, 59, 0.5);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(99, 102, 241, 0.2);
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(15, 23, 42, 0.5);
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary-dark);
    }
    
    /* Animations */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    @keyframes slideIn {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes rgbPulse {
      0% { filter: hue-rotate(0deg); }
      100% { filter: hue-rotate(360deg); }
    }
    
    @keyframes glow {
      0% { box-shadow: 0 0 5px var(--primary), 0 0 10px var(--primary), 0 0 15px var(--primary); }
      50% { box-shadow: 0 0 10px var(--primary), 0 0 20px var(--primary), 0 0 30px var(--primary); }
      100% { box-shadow: 0 0 5px var(--primary), 0 0 10px var(--primary), 0 0 15px var(--primary); }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @keyframes zoomIn {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    
    .animate-pulse-slow {
      animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    
    .animate-slide-in {
      animation: slideIn 0.3s ease-out;
    }
    
    .animate-fade-in {
      animation: fadeIn 0.2s ease-out;
    }
    
    .animate-rgb {
      animation: rgbPulse 3s linear infinite;
    }
    
    .animate-glow {
      animation: glow 2s ease-in-out infinite;
    }
    
    .animate-float {
      animation: float 3s ease-in-out infinite;
    }
    
    .animate-rotate {
      animation: rotate 20s linear infinite;
    }
    
    .animate-zoom-in {
      animation: zoomIn 0.3s ease-out;
    }
    
    /* Main container */
    .app-container {
      width: 100%;
      height: 100vh;
      background: rgba(2, 2, 23, 0.9);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      border: none;
      border-radius: 0;
    }
    
    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(10px);
      padding: 16px 24px;
      border-bottom: 1px solid rgba(99, 102, 241, 0.3);
    }
    
    .logo-section {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .logo-icon {
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: 12px;
      font-size: 24px;
      color: white;
      box-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
      animation: glow 2s ease-in-out infinite;
    }
    
    .app-title {
      font-family: 'Orbitron', monospace;
      font-size: 24px;
      font-weight: 700;
      background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 30px rgba(99, 102, 241, 0.5);
    }
    
    .system-time {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .current-time {
      font-family: 'Orbitron', monospace;
      font-size: 18px;
      font-weight: 600;
      color: var(--primary);
    }
    
    .current-date {
      font-size: 16px;
      color: var(--gray);
    }
    
    /* App Content */
    .app-content {
      flex: 1;
      display: flex;
      overflow: hidden;
    }
    
    /* Sidebar */
    .sidebar {
      width: 80px;
      background: rgba(15, 23, 42, 0.5);
      border-right: 1px solid rgba(99, 102, 241, 0.3);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px 0;
      gap: 20px;
      overflow-y: auto;
    }
    
    .sidebar-btn {
      width: 56px;
      height: 56px;
      border-radius: 12px;
      border: none;
      background: transparent;
      color: var(--light);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 22px;
      position: relative;
    }
    
    .sidebar-btn:hover {
      background: rgba(99, 102, 241, 0.2);
      transform: translateY(-3px);
    }
    
    .sidebar-btn.active {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      box-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
    }
    
    .notification-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--danger);
      box-shadow: 0 0 10px rgba(239, 68, 68, 0.8);
    }
    
    /* Main content area */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    /* Toolbar */
    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      background: rgba(15, 23, 42, 0.6);
      border-bottom: 1px solid rgba(99, 102, 241, 0.3);
    }
    
    .toolbar-title {
      font-family: 'Orbitron', monospace;
      font-size: 20px;
      font-weight: 600;
      color: var(--primary);
    }
    
    .toolbar-actions {
      display: flex;
      gap: 12px;
    }
    
    .icon-btn {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      border: 1px solid rgba(99, 102, 241, 0.3);
      background: rgba(99, 102, 241, 0.1);
      color: var(--light);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 18px;
    }
    
    .icon-btn:hover {
      background: rgba(99, 102, 241, 0.2);
      transform: translateY(-3px);
    }
    
    /* Location Bar */
    .location-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      background: rgba(15, 23, 42, 0.4);
      border-bottom: 1px solid rgba(99, 102, 241, 0.3);
    }
    
    .location-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .location-name {
      font-family: 'Orbitron', monospace;
      font-size: 24px;
      font-weight: 600;
      color: var(--light);
    }
    
    .location-btn {
      padding: 8px 16px;
      border-radius: 10px;
      border: 1px solid rgba(99, 102, 241, 0.3);
      background: rgba(99, 102, 241, 0.2);
      color: var(--light);
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
    }
    
    .location-btn:hover {
      background: rgba(99, 102, 241, 0.3);
      transform: translateY(-3px);
    }
    
    /* Weather Container */
    .weather-container {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    /* Current Weather Card */
    .current-weather {
      background: var(--weather-gradient);
      border-radius: 16px;
      padding: 24px;
      color: white;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
      overflow: hidden;
    }
    
    .current-weather::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="none"/><path d="M30,50 Q50,30 70,50 T90,50" stroke="rgba(255,255,255,0.1)" stroke-width="2" fill="none"/><path d="M10,70 Q30,50 50,70 T70,70" stroke="rgba(255,255,255,0.1)" stroke-width="2" fill="none"/><path d="M20,30 Q40,10 60,30 T80,30" stroke="rgba(255,255,255,0.1)" stroke-width="2" fill="none"/></svg>');
      background-size: 200px 200px;
      opacity: 0.2;
      animation: float 20s infinite ease-in-out;
    }
    
    .current-weather-info {
      flex: 1;
      position: relative;
      z-index: 1;
    }
    
    .current-temp {
      font-family: 'Orbitron', monospace;
      font-size: 72px;
      font-weight: 300;
      line-height: 1;
      text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
    }
    
    .current-desc {
      font-size: 20px;
      margin-top: 8px;
      opacity: 0.9;
      text-transform: capitalize;
    }
    
    .current-details {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }
    
    .current-detail {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: rgba(255, 255, 255, 0.1);
      padding: 10px 15px;
      border-radius: 10px;
      backdrop-filter: blur(5px);
    }
    
    .current-detail-value {
      font-family: 'Orbitron', monospace;
      font-size: 18px;
      font-weight: 600;
    }
    
    .current-detail-label {
      font-size: 12px;
      opacity: 0.8;
    }
    
    .current-weather-icon {
      font-size: 100px;
      opacity: 0.9;
      filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.5));
      animation: float 6s ease-in-out infinite;
    }
    
    /* Hourly Forecast */
    .hourly-forecast {
      background: var(--weather-card);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      border: 1px solid var(--weather-border);
    }
    
    .section-title {
      font-family: 'Orbitron', monospace;
      font-size: 20px;
      font-weight: 600;
      color: var(--light);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .section-title i {
      color: var(--primary);
    }
    
    .hourly-container {
      display: flex;
      gap: 12px;
      overflow-x: auto;
      padding-bottom: 8px;
    }
    
    .hourly-item {
      flex-shrink: 0;
      width: 90px;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 15px 10px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.5);
      border: 1px solid rgba(99, 102, 241, 0.2);
      transition: all 0.3s ease;
    }
    
    .hourly-item:hover {
      background: rgba(99, 102, 241, 0.2);
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(99, 102, 241, 0.2);
    }
    
    .hourly-time {
      font-family: 'Orbitron', monospace;
      font-size: 14px;
      color: var(--gray);
      margin-bottom: 10px;
    }
    
    .hourly-icon {
      font-size: 28px;
      margin-bottom: 10px;
      color: var(--neon-blue);
    }
    
    .hourly-temp {
      font-family: 'Orbitron', monospace;
      font-size: 18px;
      font-weight: 600;
      color: var(--light);
    }
    
    /* Daily Forecast */
    .daily-forecast {
      background: var(--weather-card);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      border: 1px solid var(--weather-border);
    }
    
    .daily-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .daily-item {
      display: flex;
      align-items: center;
      padding: 15px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.5);
      border: 1px solid rgba(99, 102, 241, 0.2);
      transition: all 0.3s ease;
    }
    
    .daily-item:hover {
      background: rgba(99, 102, 241, 0.2);
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(99, 102, 241, 0.2);
    }
    
    .daily-day {
      flex: 1;
      font-size: 16px;
      font-weight: 500;
      color: var(--light);
    }
    
    .daily-icon {
      font-size: 28px;
      color: var(--neon-blue);
      margin: 0 20px;
    }
    
    .daily-temp {
      font-family: 'Orbitron', monospace;
      font-size: 16px;
      font-weight: 600;
      color: var(--light);
    }
    
    /* Weather Details */
    .weather-details {
      background: var(--weather-card);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      border: 1px solid var(--weather-border);
    }
    
    .details-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }
    
    .detail-item {
      display: flex;
      align-items: center;
      padding: 15px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.5);
      border: 1px solid rgba(99, 102, 241, 0.2);
      transition: all 0.3s ease;
    }
    
    .detail-item:hover {
      background: rgba(99, 102, 241, 0.2);
      transform: translateY(-3px);
    }
    
    .detail-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      background: rgba(99, 102, 241, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      color: var(--primary);
      font-size: 20px;
    }
    
    .detail-info {
      flex: 1;
    }
    
    .detail-label {
      font-size: 14px;
      color: var(--gray);
    }
    
    .detail-value {
      font-family: 'Orbitron', monospace;
      font-size: 18px;
      font-weight: 600;
      color: var(--light);
    }
    
    /* Weather Map */
    .weather-map {
      background: var(--weather-card);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      border: 1px solid var(--weather-border);
    }
    
    .map-container {
      width: 100%;
      height: 300px;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
    }
    
    #weatherMap {
      width: 100%;
      height: 100%;
      border-radius: 12px;
    }
    
    /* Weather Charts */
    .weather-charts {
      background: var(--weather-card);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      border: 1px solid var(--weather-border);
    }
    
    .chart-container {
      width: 100%;
      height: 250px;
      position: relative;
    }
    
    /* Cities List */
    .cities-container {
      background: var(--weather-card);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      border: 1px solid var(--weather-border);
      max-height: 300px;
      overflow-y: auto;
    }
    
    .city-item {
      display: flex;
      align-items: center;
      padding: 15px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.5);
      border: 1px solid rgba(99, 102, 241, 0.2);
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .city-item:hover {
      background: rgba(99, 102, 241, 0.2);
      transform: translateY(-3px);
    }
    
    .city-item.active {
      background: rgba(99, 102, 241, 0.3);
      border-left: 3px solid var(--primary);
    }
    
    .city-name {
      flex: 1;
      font-size: 16px;
      font-weight: 500;
      color: var(--light);
    }
    
    .city-temp {
      font-family: 'Orbitron', monospace;
      font-size: 16px;
      font-weight: 600;
      color: var(--light);
      margin-right: 12px;
    }
    
    .city-icon {
      font-size: 24px;
      color: var(--neon-blue);
      margin-right: 12px;
    }
    
    .city-actions {
      display: flex;
      gap: 8px;
    }
    
    .city-action {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      border: none;
      background: transparent;
      color: var(--gray);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 16px;
    }
    
    .city-action:hover {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
      transform: scale(1.1);
    }
    
    /* Add City Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .modal.active {
      display: flex;
      opacity: 1;
    }
    
    .modal-container {
      width: 90%;
      max-width: 500px;
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      overflow: hidden;
      border: 1px solid rgba(99, 102, 241, 0.3);
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }
    
    .modal.active .modal-container {
      transform: scale(1);
    }
    
    .modal-header {
      padding: 20px;
      background: rgba(15, 23, 42, 0.8);
      border-bottom: 1px solid rgba(99, 102, 241, 0.3);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-title {
      font-family: 'Orbitron', monospace;
      font-size: 20px;
      font-weight: 700;
      color: var(--light);
    }
    
    .modal-close {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 18px;
    }
    
    .modal-close:hover {
      background: rgba(239, 68, 68, 0.3);
      transform: scale(1.1);
    }
    
    .modal-body {
      padding: 24px;
    }
    
    .modal-field {
      margin-bottom: 20px;
      position: relative;
    }
    
    .modal-label {
      display: block;
      font-size: 16px;
      font-weight: 600;
      color: var(--light);
      margin-bottom: 10px;
    }
    
    .modal-input {
      width: 100%;
      padding: 14px 16px;
      border-radius: 10px;
      border: 1px solid rgba(99, 102, 241, 0.3);
      background: rgba(15, 23, 42, 0.7);
      color: var(--light);
      font-size: 16px;
      outline: none;
      transition: all 0.2s ease;
    }
    
    .modal-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 15px rgba(99, 102, 241, 0.3);
    }
    
    .suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      max-height: 200px;
      overflow-y: auto;
      z-index: 10;
      display: none;
      border: 1px solid rgba(99, 102, 241, 0.3);
      margin-top: 5px;
    }
    
    .suggestions.active {
      display: block;
    }
    
    .suggestion-item {
      padding: 14px 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      border-bottom: 1px solid rgba(99, 102, 241, 0.1);
    }
    
    .suggestion-item:last-child {
      border-bottom: none;
    }
    
    .suggestion-item:hover {
      background: rgba(99, 102, 241, 0.2);
    }
    
    .suggestion-name {
      font-weight: 600;
      color: var(--light);
    }
    
    .suggestion-country {
      font-size: 14px;
      color: var(--gray);
      margin-left: 8px;
    }
    
    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 24px;
    }
    
    .modal-btn {
      padding: 12px 24px;
      border-radius: 10px;
      border: none;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .modal-btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4);
    }
    
    .modal-btn-primary:hover {
      background: linear-gradient(135deg, var(--primary-dark), var(--secondary));
      box-shadow: 0 15px 35px rgba(99, 102, 241, 0.6);
    }
    
    .modal-btn-secondary {
      background: rgba(99, 102, 241, 0.2);
      color: var(--light);
    }
    
    .modal-btn-secondary:hover {
      background: rgba(99, 102, 241, 0.3);
    }
    
    /* Loading Spinner */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 200px;
    }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(99, 102, 241, 0.2);
      border-top: 4px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Location Loading Animation */
    .location-loading {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }
    
    .location-loading.active {
      display: flex;
    }
    
    .location-loading-content {
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      text-align: center;
      max-width: 400px;
      border: 1px solid rgba(99, 102, 241, 0.3);
    }
    
    .location-loading-icon {
      font-size: 60px;
      color: var(--primary);
      margin-bottom: 20px;
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }
    
    .location-loading-text {
      font-family: 'Orbitron', monospace;
      font-size: 20px;
      font-weight: 600;
      color: var(--light);
      margin-bottom: 10px;
    }
    
    .location-loading-subtext {
      font-size: 16px;
      color: var(--gray);
    }
    
    /* Empty State */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 300px;
      text-align: center;
      color: var(--gray);
    }
    
    .empty-icon {
      font-size: 60px;
      margin-bottom: 20px;
      opacity: 0.5;
      color: var(--primary);
    }
    
    .empty-title {
      font-family: 'Orbitron', monospace;
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 10px;
      color: var(--light);
    }
    
    .empty-description {
      margin-bottom: 24px;
      max-width: 400px;
    }
    
    .empty-btn {
      padding: 12px 24px;
      border-radius: 10px;
      border: none;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4);
    }
    
    .empty-btn:hover {
      background: linear-gradient(135deg, var(--primary-dark), var(--secondary));
      box-shadow: 0 15px 35px rgba(99, 102, 241, 0.6);
      transform: translateY(-3px);
    }
    
    /* Notification */
    .notification {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      padding: 20px;
      max-width: 350px;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 2000;
      border: 1px solid rgba(99, 102, 241, 0.3);
      border-left: 4px solid var(--primary);
    }
    
    .notification.show {
      transform: translateY(0);
      opacity: 1;
    }
    
    .notification-title {
      font-family: 'Orbitron', monospace;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--light);
      font-size: 18px;
    }
    
    .notification-message {
      font-size: 16px;
      color: var(--gray);
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .sidebar {
        width: 60px;
      }
      
      .sidebar-btn {
        width: 44px;
        height: 44px;
        font-size: 18px;
      }
      
      .current-temp {
        font-size: 56px;
      }
      
      .details-grid {
        grid-template-columns: 1fr;
      }
      
      .modal-container {
        width: 95%;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="header">
      <div class="logo-section">
        <div class="logo-icon animate-glow">
          <i class="fas fa-cloud-sun"></i>
        </div>
        <div class="app-title">NEXUS WEATHER</div>
      </div>
      
      <div class="system-time">
        <div class="current-time" id="headerTime">00:00:00</div>
        <div class="current-date" id="headerDate">Carregando...</div>
      </div>
    </header>
    
    <!-- App Content -->
    <div class="app-content">
      <!-- Sidebar -->
      <div class="sidebar">
        <button class="sidebar-btn active" title="Clima" data-view="weather">
          <i class="fas fa-cloud-sun"></i>
        </button>
        <button class="sidebar-btn" title="Mapa" data-view="map">
          <i class="fas fa-map"></i>
        </button>
        <button class="sidebar-btn" title="Cidades" data-view="cities">
          <i class="fas fa-city"></i>
        </button>
        <button class="sidebar-btn" title="Gráficos" data-view="charts">
          <i class="fas fa-chart-line"></i>
        </button>
        
        <div class="sidebar-btn" title="Modo Gamer" style="margin-top: auto; background: linear-gradient(135deg, var(--danger), var(--warning));">
          <i class="fas fa-gamepad"></i>
        </div>
      </div>
      
      <!-- Main Content -->
      <div class="main-content">
        <!-- Toolbar -->
        <div class="toolbar">
          <div class="toolbar-title">Previsão do Tempo</div>
          
          <div class="toolbar-actions">
            <button class="icon-btn" id="refreshBtn" title="Atualizar">
              <i class="fas fa-sync-alt"></i>
            </button>
            <button class="icon-btn" id="addCityBtn" title="Adicionar cidade">
              <i class="fas fa-plus"></i>
            </button>
            <button class="icon-btn" id="locationBtn" title="Usar localização atual">
              <i class="fas fa-location-arrow"></i>
            </button>
          </div>
        </div>
        
        <!-- Location Bar -->
        <div class="location-bar">
          <div class="location-info">
            <h2 class="location-name" id="locationName">Carregando...</h2>
          </div>
          <button class="location-btn" id="unitsToggle">
            <i class="fas fa-thermometer-half"></i>
            <span id="unitsText">°C</span>
          </button>
        </div>
        
        <!-- Weather Container -->
        <div class="weather-container" id="weatherContainer">
          <!-- Loading state -->
          <div class="loading" id="loadingState">
            <div class="spinner"></div>
          </div>
          
          <!-- Weather content will be inserted here -->
        </div>
      </div>
    </div>
  </div>
  
  <!-- Add City Modal -->
  <div class="modal" id="addCityModal">
    <div class="modal-container">
      <div class="modal-header">
        <div class="modal-title">Adicionar Cidade</div>
        <button class="modal-close" id="closeAddCityModal">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <div class="modal-field">
          <label class="modal-label" for="cityName">Nome da cidade</label>
          <input type="text" class="modal-input" id="cityName" placeholder="Ex: São Paulo, Brasília, Rio de Janeiro" autocomplete="off">
          <div class="suggestions" id="citySuggestions"></div>
        </div>
        
        <div class="modal-actions">
          <button class="modal-btn modal-btn-secondary" id="cancelAddCity">Cancelar</button>
          <button class="modal-btn modal-btn-primary" id="confirmAddCity">Adicionar</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Location Loading Modal -->
  <div class="location-loading" id="locationLoading">
    <div class="location-loading-content">
      <div class="location-loading-icon">
        <i class="fas fa-location-arrow"></i>
      </div>
      <div class="location-loading-text">Buscando localização atual...</div>
      <div class="location-loading-subtext">Isso pode levar alguns segundos</div>
    </div>
  </div>
  
  <!-- Notification -->
  <div class="notification" id="notification">
    <div class="notification-title" id="notificationTitle">Sucesso</div>
    <div class="notification-message" id="notificationMessage">Operação realizada com sucesso!</div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // Weather App
    const API_KEY = '8ab6ab5a8fd2304942bbffad300520e4';
    const API_BASE_URL = 'https://api.openweathermap.org/data/2.5';
    
    // App state
    let currentCity = null;
    let cities = [];
    let units = 'metric'; // metric (Celsius) or imperial (Fahrenheit)
    let currentView = 'weather';
    let searchHistory = [];
    let chartInstance = null;
    let mapInstance = null;
    
    // DOM elements
    const locationName = document.getElementById('locationName');
    const weatherContainer = document.getElementById('weatherContainer');
    const loadingState = document.getElementById('loadingState');
    const refreshBtn = document.getElementById('refreshBtn');
    const addCityBtn = document.getElementById('addCityBtn');
    const locationBtn = document.getElementById('locationBtn');
    const unitsToggle = document.getElementById('unitsToggle');
    const unitsText = document.getElementById('unitsText');
    const addCityModal = document.getElementById('addCityModal');
    const cityNameInput = document.getElementById('cityName');
    const citySuggestions = document.getElementById('citySuggestions');
    const closeAddCityModal = document.getElementById('closeAddCityModal');
    const cancelAddCity = document.getElementById('cancelAddCity');
    const confirmAddCity = document.getElementById('confirmAddCity');
    const locationLoading = document.getElementById('locationLoading');
    const notification = document.getElementById('notification');
    const notificationTitle = document.getElementById('notificationTitle');
    const notificationMessage = document.getElementById('notificationMessage');
    
    // Initialize app
    document.addEventListener('DOMContentLoaded', () => {
      loadCitiesFromStorage();
      loadSearchHistory();
      
      // If there are saved cities, load the first one
      if (cities.length > 0) {
        loadCityWeather(cities[0]);
      } else {
        // Try to get user's current location
        getCurrentLocation();
      }
      
      setupEventListeners();
      updateDateTime();
      setInterval(updateDateTime, 1000);
    });
    
    // Update date and time
    function updateDateTime() {
      const now = new Date();
      
      // Update current time
      const timeString = now.toLocaleTimeString('pt-BR');
      document.getElementById('headerTime').textContent = timeString;
      
      // Update current date
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      const dateString = now.toLocaleDateString('pt-BR', options);
      document.getElementById('headerDate').textContent = dateString;
    }
    
    // Setup event listeners
    function setupEventListeners() {
      // Refresh button
      refreshBtn.addEventListener('click', () => {
        if (currentCity) {
          loadCityWeather(currentCity);
        }
      });
      
      // Add city button
      addCityBtn.addEventListener('click', () => {
        addCityModal.classList.add('active');
        cityNameInput.focus();
      });
      
      // Location button
      locationBtn.addEventListener('click', getCurrentLocation);
      
      // Units toggle
      unitsToggle.addEventListener('click', () => {
        units = units === 'metric' ? 'imperial' : 'metric';
        unitsText.textContent = units === 'metric' ? '°C' : '°F';
        
        if (currentCity) {
          loadCityWeather(currentCity);
        }
      });
      
      // City input for suggestions
      cityNameInput.addEventListener('input', debounce(handleCityInput, 300));
      
      // Modal events
      closeAddCityModal.addEventListener('click', () => {
        addCityModal.classList.remove('active');
        cityNameInput.value = '';
        citySuggestions.classList.remove('active');
      });
      
      cancelAddCity.addEventListener('click', () => {
        addCityModal.classList.remove('active');
        cityNameInput.value = '';
        citySuggestions.classList.remove('active');
      });
      
      confirmAddCity.addEventListener('click', addCity);
      
      // Enter key in city input
      cityNameInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          addCity();
        }
      });
      
      // Click outside suggestions to close
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.modal-field')) {
          citySuggestions.classList.remove('active');
        }
      });
      
      // Sidebar navigation
      document.querySelectorAll('.sidebar-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const view = this.getAttribute('data-view');
          if (view) {
            // Update active sidebar button
            document.querySelectorAll('.sidebar-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // Show selected view
            switchView(view);
          }
        });
      });
    }
    
    // Load cities from localStorage
    function loadCitiesFromStorage() {
      const savedCities = localStorage.getItem('weatherCities');
      if (savedCities) {
        cities = JSON.parse(savedCities);
      }
    }
    
    // Save cities to localStorage
    function saveCitiesToStorage() {
      localStorage.setItem('weatherCities', JSON.stringify(cities));
    }
    
    // Load search history from localStorage
    function loadSearchHistory() {
      const savedHistory = localStorage.getItem('weatherSearchHistory');
      if (savedHistory) {
        searchHistory = JSON.parse(savedHistory);
      }
    }
    
    // Save search history to localStorage
    function saveSearchHistoryToStorage() {
      localStorage.setItem('weatherSearchHistory', JSON.stringify(searchHistory));
    }
    
    // Add to search history
    function addToSearchHistory(city) {
      // Remove if already exists
      searchHistory = searchHistory.filter(item => 
        !(item.name === city.name && item.country === city.country)
      );
      
      // Add to beginning
      searchHistory.unshift({
        name: city.name,
        country: city.country,
        timestamp: new Date().toISOString()
      });
      
      // Limit to 10 items
      if (searchHistory.length > 10) {
        searchHistory = searchHistory.slice(0, 10);
      }
      
      saveSearchHistoryToStorage();
    }
    
    // Get user's current location
    function getCurrentLocation() {
      locationLoading.classList.add('active');
      
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          position => {
            locationLoading.classList.remove('active');
            const { latitude, longitude } = position.coords;
            loadWeatherByCoords(latitude, longitude);
          },
          error => {
            locationLoading.classList.remove('active');
            console.error('Error getting location:', error);
            showNotification('Erro', 'Não foi possível obter sua localização. Por favor, adicione uma cidade manualmente.');
            
            // Show empty state
            showEmptyState();
          }
        );
      } else {
        locationLoading.classList.remove('active');
        showNotification('Erro', 'Seu navegador não suporta geolocalização. Por favor, adicione uma cidade manualmente.');
        
        // Show empty state
        showEmptyState();
      }
    }
    
    // Load weather by coordinates
    function loadWeatherByCoords(lat, lon) {
      showLoading();
      
      fetch(`${API_BASE_URL}/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=${units}&lang=pt_br`)
        .then(response => {
          if (!response.ok) {
            throw new Error('Weather data not found');
          }
          return response.json();
        })
        .then(data => {
          currentCity = {
            name: data.name,
            country: data.sys.country,
            lat: data.coord.lat,
            lon: data.coord.lon
          };
          
          // Add to cities if not already there
          if (!cities.some(city => city.name === currentCity.name && city.country === currentCity.country)) {
            cities.unshift(currentCity);
            saveCitiesToStorage();
          }
          
          // Add to search history
          addToSearchHistory(currentCity);
          
          locationName.textContent = `${currentCity.name}, ${currentCity.country}`;
          displayWeatherData(data);
        })
        .catch(error => {
          console.error('Error fetching weather data:', error);
          showNotification('Erro', 'Não foi possível obter os dados climáticos.');
          showEmptyState();
        });
    }
    
    // Load city weather
    function loadCityWeather(city) {
      showLoading();
      
      fetch(`${API_BASE_URL}/weather?q=${city.name},${city.country}&appid=${API_KEY}&units=${units}&lang=pt_br`)
        .then(response => {
          if (!response.ok) {
            throw new Error('Weather data not found');
          }
          return response.json();
        })
        .then(data => {
          currentCity = city;
          locationName.textContent = `${city.name}, ${city.country}`;
          
          // Add to search history
          addToSearchHistory(city);
          
          displayWeatherData(data);
        })
        .catch(error => {
          console.error('Error fetching weather data:', error);
          showNotification('Erro', 'Não foi possível obter os dados climáticos para esta cidade.');
          showEmptyState();
        });
    }
    
    // Display weather data
    function displayWeatherData(data) {
      // Get current weather
      const currentWeather = {
        temp: Math.round(data.main.temp),
        feels_like: Math.round(data.main.feels_like),
        humidity: data.main.humidity,
        pressure: data.main.pressure,
        wind_speed: data.wind.speed,
        wind_deg: data.wind.deg,
        visibility: data.visibility / 1000, // Convert to km
        uv_index: 0, // Not available in current weather API
        description: data.weather[0].description,
        icon: data.weather[0].icon
      };
      
      // Get 5-day forecast
      fetch(`${API_BASE_URL}/forecast?q=${data.name},${data.sys.country}&appid=${API_KEY}&units=${units}&lang=pt_br`)
        .then(response => response.json())
        .then(forecastData => {
          // Process forecast data
          const dailyForecast = processDailyForecast(forecastData);
          const hourlyForecast = processHourlyForecast(forecastData);
          
          // Display weather based on current view
          if (currentView === 'weather') {
            displayWeatherView(currentWeather, dailyForecast, hourlyForecast);
          } else if (currentView === 'map') {
            displayMapView(data.coord.lat, data.coord.lon, data.name);
          } else if (currentView === 'cities') {
            displayCitiesView();
          } else if (currentView === 'charts') {
            displayChartsView(hourlyForecast);
          }
        })
        .catch(error => {
          console.error('Error fetching forecast data:', error);
          showNotification('Erro', 'Não foi possível obter a previsão estendida.');
        });
    }
    
    // Display weather view
    function displayWeatherView(currentWeather, dailyForecast, hourlyForecast) {
      weatherContainer.innerHTML = `
        <!-- Current Weather -->
        <div class="current-weather animate-zoom-in">
          <div class="current-weather-info">
            <div class="current-temp">${currentWeather.temp}°</div>
            <div class="current-desc">${capitalizeFirstLetter(currentWeather.description)}</div>
            <div class="current-details">
              <div class="current-detail">
                <div class="current-detail-value">${currentWeather.feels_like}°</div>
                <div class="current-detail-label">Sensação</div>
              </div>
              <div class="current-detail">
                <div class="current-detail-value">${currentWeather.humidity}%</div>
                <div class="current-detail-label">Umidade</div>
              </div>
              <div class="current-detail">
                <div class="current-detail-value">${currentWeather.wind_speed} ${units === 'metric' ? 'm/s' : 'mph'}</div>
                <div class="current-detail-label">Vento</div>
              </div>
            </div>
          </div>
          <div class="current-weather-icon">
            ${getWeatherIcon(currentWeather.icon)}
          </div>
        </div>
        
        <!-- Hourly Forecast -->
        <div class="hourly-forecast animate-slide-in">
          <h3 class="section-title">
            <i class="fas fa-clock"></i>
            <span>Previsão por hora</span>
          </h3>
          <div class="hourly-container">
            ${hourlyForecast.map(hour => `
              <div class="hourly-item">
                <div class="hourly-time">${formatTime(hour.dt)}</div>
                <div class="hourly-icon">${getWeatherIcon(hour.icon)}</div>
                <div class="hourly-temp">${Math.round(hour.temp)}°</div>
              </div>
            `).join('')}
          </div>
        </div>
        
        <!-- Daily Forecast -->
        <div class="daily-forecast animate-slide-in">
          <h3 class="section-title">
            <i class="fas fa-calendar-alt"></i>
            <span>Previsão de 5 dias</span>
          </h3>
          <div class="daily-container">
            ${dailyForecast.map(day => `
              <div class="daily-item">
                <div class="daily-day">${formatDay(day.dt)}</div>
                <div class="daily-icon">${getWeatherIcon(day.icon)}</div>
                <div class="daily-temp">${Math.round(day.temp_min)}° / ${Math.round(day.temp_max)}°</div>
              </div>
            `).join('')}
          </div>
        </div>
        
        <!-- Weather Details -->
        <div class="weather-details animate-slide-in">
          <h3 class="section-title">
            <i class="fas fa-info-circle"></i>
            <span>Detalhes</span>
          </h3>
          <div class="details-grid">
            <div class="detail-item">
              <div class="detail-icon">
                <i class="fas fa-eye"></i>
              </div>
              <div class="detail-info">
                <div class="detail-label">Visibilidade</div>
                <div class="detail-value">${currentWeather.visibility} km</div>
              </div>
            </div>
            <div class="detail-item">
              <div class="detail-icon">
                <i class="fas fa-tint"></i>
              </div>
              <div class="detail-info">
                <div class="detail-label">Umidade</div>
                <div class="detail-value">${currentWeather.humidity}%</div>
              </div>
            </div>
            <div class="detail-item">
              <div class="detail-icon">
                <i class="fas fa-wind"></i>
              </div>
              <div class="detail-info">
                <div class="detail-label">Vento</div>
                <div class="detail-value">${currentWeather.wind_speed} ${units === 'metric' ? 'm/s' : 'mph'}</div>
              </div>
            </div>
            <div class="detail-item">
              <div class="detail-icon">
                <i class="fas fa-compress-arrows-alt"></i>
              </div>
              <div class="detail-info">
                <div class="detail-label">Pressão</div>
                <div class="detail-value">${currentWeather.pressure} hPa</div>
              </div>
            </div>
          </div>
        </div>
      `;
    }
    
    // Display map view
    function displayMapView(lat, lon, cityName) {
      weatherContainer.innerHTML = `
        <div class="weather-map animate-zoom-in">
          <h3 class="section-title">
            <i class="fas fa-map"></i>
            <span>Mapa do Clima</span>
          </h3>
          <div class="map-container">
            <div id="weatherMap"></div>
          </div>
        </div>
      `;
      
      // Initialize map
      setTimeout(() => {
        initializeMap(lat, lon, cityName);
      }, 100);
    }
    
    // Display cities view
    function displayCitiesView() {
      weatherContainer.innerHTML = `
        <div class="cities-container animate-zoom-in">
          <h3 class="section-title">
            <i class="fas fa-city"></i>
            <span>Minhas Cidades</span>
          </h3>
          ${cities.length > 0 ? cities.map(city => `
            <div class="city-item ${currentCity && currentCity.name === city.name && currentCity.country === city.country ? 'active' : ''}" data-city="${city.name},${city.country}">
              <div class="city-icon">
                ${getCityWeatherIcon(city.name, city.country)}
              </div>
              <div class="city-name">${city.name}, ${getCountryName(city.country)}</div>
              <div class="city-temp" id="temp-${city.name}-${city.country}">--°</div>
              <div class="city-actions">
                <button class="city-action remove-city" data-city="${city.name},${city.country}" title="Remover">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          `).join('') : `
            <div class="empty-state">
              <div class="empty-icon">
                <i class="fas fa-city"></i>
              </div>
              <div class="empty-title">Nenhuma cidade adicionada</div>
              <div class="empty-description">
                Adicione cidades para acompanhar a previsão do tempo em diferentes locais.
              </div>
              <button class="empty-btn" id="emptyStateAddCity">Adicionar Cidade</button>
            </div>
          `}
        </div>
      `;
      
      // Add event listeners
      document.querySelectorAll('.city-item').forEach(item => {
        item.addEventListener('click', (e) => {
          if (!e.target.closest('.city-action')) {
            const cityData = item.getAttribute('data-city').split(',');
            const city = {
              name: cityData[0],
              country: cityData[1]
            };
            loadCityWeather(city);
          }
        });
      });
      
      document.querySelectorAll('.remove-city').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const cityData = btn.getAttribute('data-city').split(',');
          removeCity(cityData[0], cityData[1]);
        });
      });
      
      const emptyStateAddCity = document.getElementById('emptyStateAddCity');
      if (emptyStateAddCity) {
        emptyStateAddCity.addEventListener('click', () => {
          addCityModal.classList.add('active');
          cityNameInput.focus();
        });
      }
      
      // Load weather data for all cities
      cities.forEach(city => {
        loadCityWeatherPreview(city);
      });
    }
    
    // Display charts view
    function displayChartsView(hourlyForecast) {
      weatherContainer.innerHTML = `
        <div class="weather-charts animate-zoom-in">
          <h3 class="section-title">
            <i class="fas fa-chart-line"></i>
            <span>Gráficos de Temperatura</span>
          </h3>
          <div class="chart-container">
            <canvas id="temperatureChart"></canvas>
          </div>
        </div>
      `;
      
      // Create temperature chart
      setTimeout(() => {
        createTemperatureChart(hourlyForecast);
      }, 100);
    }
    
    // Load city weather preview for cities view
    function loadCityWeatherPreview(city) {
      fetch(`${API_BASE_URL}/weather?q=${city.name},${city.country}&appid=${API_KEY}&units=${units}&lang=pt_br`)
        .then(response => {
          if (!response.ok) {
            throw new Error('Weather data not found');
          }
          return response.json();
        })
        .then(data => {
          const tempElement = document.getElementById(`temp-${city.name}-${city.country}`);
          if (tempElement) {
            tempElement.textContent = `${Math.round(data.main.temp)}°`;
          }
        })
        .catch(error => {
          console.error('Error fetching weather data for preview:', error);
        });
    }
    
    // Get city weather icon
    function getCityWeatherIcon(cityName, country) {
      // This is a simplified version - in a real app, you would fetch the actual weather
      const icons = ['fa-sun', 'fa-cloud-sun', 'fa-cloud', 'fa-cloud-rain'];
      const randomIcon = icons[Math.floor(Math.random() * icons.length)];
      return `<i class="fas ${randomIcon}"></i>`;
    }
    
    // Initialize map
    function initializeMap(lat, lon, cityName) {
      // Destroy previous map if exists
      if (mapInstance) {
        mapInstance.remove();
      }
      
      // Create new map
      mapInstance = L.map('weatherMap').setView([lat, lon], 10);
      
      // Add tile layer
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
      }).addTo(mapInstance);
      
      // Add weather overlay
      const weatherLayer = L.tileLayer(`https://tile.openweathermap.org/map/{layer}/{z}/{x}/{y}.png?appid=${API_KEY}`, {
        layer: 'clouds_new',
        attribution: '© OpenWeatherMap',
        opacity: 0.5
      }).addTo(mapInstance);
      
      // Add marker for city
      L.marker([lat, lon])
        .addTo(mapInstance)
        .bindPopup(`<b>${cityName}</b>`)
        .openPopup();
    }
    
    // Process daily forecast
    function processDailyForecast(data) {
      const dailyMap = {};
      
      data.list.forEach(item => {
        const date = new Date(item.dt * 1000).toLocaleDateString();
        
        if (!dailyMap[date]) {
          dailyMap[date] = {
            dt: item.dt,
            temp_min: item.main.temp_min,
            temp_max: item.main.temp_max,
            icon: item.weather[0].icon
          };
        } else {
          dailyMap[date].temp_min = Math.min(dailyMap[date].temp_min, item.main.temp_min);
          dailyMap[date].temp_max = Math.max(dailyMap[date].temp_max, item.main.temp_max);
        }
      });
      
      // Convert to array and limit to 5 days
      return Object.values(dailyMap).slice(0, 5);
    }
    
    // Process hourly forecast
    function processHourlyForecast(data) {
      // Get next 24 hours
      const now = new Date();
      const tomorrow = new Date(now);
      tomorrow.setDate(tomorrow.getDate() + 1);
      
      return data.list
        .filter(item => {
          const itemDate = new Date(item.dt * 1000);
          return itemDate >= now && itemDate <= tomorrow;
        })
        .slice(0, 8); // Limit to 8 items
    }
    
    // Create temperature chart
    function createTemperatureChart(hourlyData) {
      const ctx = document.getElementById('temperatureChart').getContext('2d');
      
      // Destroy previous chart if exists
      if (chartInstance) {
        chartInstance.destroy();
      }
      
      chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: hourlyData.map(hour => formatTime(hour.dt)),
          datasets: [{
            label: 'Temperatura',
            data: hourlyData.map(hour => Math.round(hour.temp)),
            borderColor: getComputedStyle(document.documentElement).getPropertyValue('--chart-line'),
            backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--chart-fill'),
            borderWidth: 2,
            tension: 0.4,
            fill: true,
            pointBackgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--chart-line'),
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointRadius: 4,
            pointHoverRadius: 6
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              mode: 'index',
              intersect: false,
              callbacks: {
                label: function(context) {
                  return `Temperatura: ${context.parsed.y}°`;
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: false,
              ticks: {
                callback: function(value) {
                  return value + '°';
                },
                color: getComputedStyle(document.documentElement).getPropertyValue('--light')
              },
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              }
            },
            x: {
              ticks: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--light')
              },
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              }
            }
          }
        }
      });
    }
    
    // Get weather icon
    function getWeatherIcon(iconCode) {
      const iconMap = {
        '01d': '<i class="fas fa-sun"></i>',
        '01n': '<i class="fas fa-moon"></i>',
        '02d': '<i class="fas fa-cloud-sun"></i>',
        '02n': '<i class="fas fa-cloud-moon"></i>',
        '03d': '<i class="fas fa-cloud"></i>',
        '03n': '<i class="fas fa-cloud"></i>',
        '04d': '<i class="fas fa-cloud"></i>',
        '04n': '<i class="fas fa-cloud"></i>',
        '09d': '<i class="fas fa-cloud-showers-heavy"></i>',
        '09n': '<i class="fas fa-cloud-showers-heavy"></i>',
        '10d': '<i class="fas fa-cloud-rain"></i>',
        '10n': '<i class="fas fa-cloud-rain"></i>',
        '11d': '<i class="fas fa-bolt"></i>',
        '11n': '<i class="fas fa-bolt"></i>',
        '13d': '<i class="fas fa-snowflake"></i>',
        '13n': '<i class="fas fa-snowflake"></i>',
        '50d': '<i class="fas fa-smog"></i>',
        '50n': '<i class="fas fa-smog"></i>'
      };
      
      return iconMap[iconCode] || '<i class="fas fa-question"></i>';
    }
    
    // Format time
    function formatTime(timestamp) {
      const date = new Date(timestamp * 1000);
      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }
    
    // Format day
    function formatDay(timestamp) {
      const date = new Date(timestamp * 1000);
      const today = new Date();
      const tomorrow = new Date(today);
      tomorrow.setDate(tomorrow.getDate() + 1);
      
      if (date.toDateString() === today.toDateString()) {
        return 'Hoje';
      } else if (date.toDateString() === tomorrow.toDateString()) {
        return 'Amanhã';
      } else {
        return date.toLocaleDateString([], { weekday: 'short' });
      }
    }
    
    // Capitalize first letter
    function capitalizeFirstLetter(string) {
      return string.charAt(0).toUpperCase() + string.slice(1);
    }
    
    // Handle city input for suggestions
    function handleCityInput() {
      const query = cityNameInput.value.trim();
      
      if (query.length < 2) {
        citySuggestions.classList.remove('active');
        return;
      }
      
      // Use a simple list of common cities for suggestions
      const commonCities = [
        { name: 'São Paulo', country: 'BR' },
        { name: 'Rio de Janeiro', country: 'BR' },
        { name: 'Brasília', country: 'BR' },
        { name: 'Salvador', country: 'BR' },
        { name: 'Fortaleza', country: 'BR' },
        { name: 'Belo Horizonte', country: 'BR' },
        { name: 'Manaus', country: 'BR' },
        { name: 'Curitiba', country: 'BR' },
        { name: 'Recife', country: 'BR' },
        { name: 'Porto Alegre', country: 'BR' },
        { name: 'New York', country: 'US' },
        { name: 'Los Angeles', country: 'US' },
        { name: 'Chicago', country: 'US' },
        { name: 'Miami', country: 'US' },
        { name: 'London', country: 'GB' },
        { name: 'Paris', country: 'FR' },
        { name: 'Berlin', country: 'DE' },
        { name: 'Rome', country: 'IT' },
        { name: 'Madrid', country: 'ES' },
        { name: 'Tokyo', country: 'JP' }
      ];
      
      // Filter cities based on query
      const filteredCities = commonCities.filter(city => 
        city.name.toLowerCase().includes(query.toLowerCase()) ||
        city.country.toLowerCase().includes(query.toLowerCase())
      );
      
      // Display suggestions
      if (filteredCities.length > 0) {
        citySuggestions.innerHTML = filteredCities.map(city => `
          <div class="suggestion-item" data-city="${city.name}" data-country="${city.country}">
            <span class="suggestion-name">${city.name}</span>
            <span class="suggestion-country">${getCountryName(city.country)}</span>
          </div>
        `).join('');
        
        citySuggestions.classList.add('active');
        
        // Add event listeners to suggestion items
        document.querySelectorAll('.suggestion-item').forEach(item => {
          item.addEventListener('click', () => {
            const cityName = item.getAttribute('data-city');
            const country = item.getAttribute('data-country');
            cityNameInput.value = `${cityName}, ${country}`;
            citySuggestions.classList.remove('active');
          });
        });
      } else {
        citySuggestions.classList.remove('active');
      }
    }
    
    // Get country name from code
    function getCountryName(code) {
      const countries = {
        'BR': 'Brasil',
        'US': 'Estados Unidos',
        'GB': 'Reino Unido',
        'FR': 'França',
        'DE': 'Alemanha',
        'IT': 'Itália',
        'ES': 'Espanha',
        'JP': 'Japão'
      };
      
      return countries[code] || code;
    }
    
    // Add city
    function addCity() {
      const cityNameValue = cityNameInput.value.trim();
      
      if (!cityNameValue) {
        showNotification('Erro', 'Por favor, digite o nome de uma cidade.');
        return;
      }
      
      // Parse city and country
      let cityName, country;
      
      if (cityNameValue.includes(',')) {
        const parts = cityNameValue.split(',');
        cityName = parts[0].trim();
        country = parts[1].trim();
      } else {
        cityName = cityNameValue;
        country = '';
      }
      
      showLoading();
      
      fetch(`${API_BASE_URL}/weather?q=${cityName}${country ? ',' + country : ''}&appid=${API_KEY}&units=${units}&lang=pt_br`)
        .then(response => {
          if (!response.ok) {
            throw new Error('City not found');
          }
          return response.json();
        })
        .then(data => {
          const newCity = {
            name: data.name,
            country: data.sys.country,
            lat: data.coord.lat,
            lon: data.coord.lon
          };
          
          // Check if city already exists
          if (cities.some(city => city.name === newCity.name && city.country === newCity.country)) {
            showNotification('Aviso', 'Esta cidade já está na sua lista.');
            addCityModal.classList.remove('active');
            cityNameInput.value = '';
            citySuggestions.classList.remove('active');
            return;
          }
          
          // Add to cities
          cities.push(newCity);
          saveCitiesToStorage();
          
          // Load weather for new city
          loadCityWeather(newCity);
          
          // Close modal
          addCityModal.classList.remove('active');
          cityNameInput.value = '';
          citySuggestions.classList.remove('active');
          
          showNotification('Sucesso', `${newCity.name} foi adicionada à sua lista de cidades.`);
        })
        .catch(error => {
          console.error('Error adding city:', error);
          showNotification('Erro', 'Não foi possível encontrar esta cidade. Verifique o nome e tente novamente.');
          weatherContainer.innerHTML = '';
          showEmptyState();
        });
    }
    
    // Remove city
    function removeCity(name, country) {
      cities = cities.filter(city => !(city.name === name && city.country === country));
      saveCitiesToStorage();
      
      // If we removed the current city, load the first one in the list
      if (currentCity && currentCity.name === name && currentCity.country === country) {
        if (cities.length > 0) {
          loadCityWeather(cities[0]);
        } else {
          currentCity = null;
          locationName.textContent = 'Selecione uma cidade';
          showEmptyState();
        }
      } else {
        // Refresh the display
        if (currentView === 'cities') {
          displayCitiesView();
        }
      }
      
      showNotification('Sucesso', `${name} foi removida da sua lista de cidades.`);
    }
    
    // Switch view
    function switchView(view) {
      currentView = view;
      
      if (currentCity) {
        loadCityWeather(currentCity);
      } else {
        showEmptyState();
      }
    }
    
    // Show loading state
    function showLoading() {
      weatherContainer.innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
        </div>
      `;
    }
    
    // Show empty state
    function showEmptyState() {
      weatherContainer.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">
            <i class="fas fa-cloud-sun"></i>
          </div>
          <div class="empty-title">Nenhuma cidade adicionada</div>
          <div class="empty-description">
            Adicione uma cidade para ver a previsão do tempo ou use sua localização atual.
          </div>
          <button class="empty-btn" id="emptyStateAddCity">Adicionar cidade</button>
        </div>
      `;
      
      // Add event listener to the button
      document.getElementById('emptyStateAddCity').addEventListener('click', () => {
        addCityModal.classList.add('active');
        cityNameInput.focus();
      });
    }
    
    // Show notification
    function showNotification(title, message) {
      notificationTitle.textContent = title;
      notificationMessage.textContent = message;
      
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }
    
    // Debounce function
    function debounce(func, wait) {
      let timeout;
      return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }
  </script>
</body>
</html>